<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouse Speed Plot</title>
    <!-- Include Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .parent{
            position: relative;
            height: 500px;
            width: 700px;
            display: flex;
            padding: 10px;
            z-index: -1;
            top: 60px;
        }
        .cover {
            position: absolute;
            height: 100%;
            width: 50px;
            display: block;
            background-color: white;
        }
        canvas {
            margin-right: 50px;
        }
    </style>
</head>
<body>
    <div class="parent">
        <div class="cover"></div>
        <canvas id="speedChart"></canvas>
    </div>
    <div>
        <p>Speed X: <span id="speedX"></span></p>
        <p>Speed Y: <span id="speedY"></span></p>
        <p>Max Speed X: <span id="maxSpeedX"></span></p>
        <p>Max Speed Y: <span id="maxSpeedY"></span></p>
    </div>
    
    <script>
        var prevEvent, currentEvent;
        var speedXData = [];
        var speedYData = [];
        var timeData = [];
        var chart;
        var maxSpeedX = 0;
        var maxSpeedY = 0;

        // Handle both mouse and touch events
        function handleInputEvent(event) {
            currentEvent = event;
        }

        document.documentElement.onmousemove = handleInputEvent;
        document.documentElement.addEventListener('touchmove', function (event) {
            event.preventDefault(); // Prevent scrolling on touch devices
            handleInputEvent(event.touches[0]); // Use the first touch point
        });

        setInterval(function () {
            if (prevEvent && currentEvent) {
                var speedX = (currentEvent.screenX - prevEvent.screenX) * 10; // Negative values allowed
                var speedY = (prevEvent.screenY - currentEvent.screenY) * 10; // Negative values allowed

                document.getElementById("speedX").innerText = Math.round(speedX);
                document.getElementById("speedY").innerText = Math.round(speedY);

                document.getElementById("maxSpeedX").innerText = Math.round(
                    speedX > maxSpeedX ? (maxSpeedX = speedX) : maxSpeedX
                );

                document.getElementById("maxSpeedY").innerText = Math.round(
                    speedY > maxSpeedY ? (maxSpeedY = speedY) : maxSpeedY
                );

                if (speedXData.length > 100) {
                    speedXData.shift();
                    speedYData.shift();
                    timeData.shift();
                }

                // Push speed data and time to arrays for the chart
                speedXData.push(speedX);
                speedYData.push(speedY);
                timeData.push(new Date().toLocaleTimeString());

                // Update the chart
                updateChart();
            }

            prevEvent = currentEvent;
        }, 150);

        // Function to update the chart
        function updateChart() {
            if (!chart) {
                // Initialize the chart
                var ctx = document.getElementById("speedChart").getContext("2d");
                chart = new Chart(ctx, {
                    type: "line",
                    data: {
                        labels: timeData,
                        datasets: [
                            {
                                label: "Speed X",
                                data: speedXData,
                                borderColor: "#f0bb74",
                                borderWidth: 3,
                                fill: false,
                                lineTension: 0.3,
                                fill: "start",
                                backgroundColor: "rgba(240, 187, 116, 0.05)",
                            },
                            {
                                label: "Speed Y",
                                data: speedYData,
                                borderColor: "#5990ff",
                                borderWidth: 2,
                                fill: false,
                                lineTension: 0.3,
                                fill: "start",
                                backgroundColor: "rgba(89, 144, 255, 0.05)"
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false,
                            },
                        },
                        elements: {
                            point: {
                                radius: 0,
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    display: false,
                                },
                                grid: {
                                    display: false,
                                },
                                border: {
                                    display: false,
                                }
                            },
                            y: {
                                ticks: {
                                    display: false,
                                },
                                grid: {
                                    color: "#eaf9ff",
                                },
                                border: {
                                    display: false,
                                    dash: [10, 10]
                                }
                            },
                        },
                    },
                });
            } else {
                chart.data.labels = timeData;
                chart.data.datasets[0].data = speedXData;
                chart.data.datasets[1].data = speedYData;
                chart.update();
            }
        }
    </script>
</body>
</html>